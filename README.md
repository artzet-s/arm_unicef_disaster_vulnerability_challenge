Code - 5th final LeaderBoard position - Arm UNICEF Disaster Vulnerability Challenge
===================================================================================

This repository contains code and documentation in order to reproduce the results I obtained for the "Arm UNICEF Disaster Vulnerability Challenge"

Detail about the challenge here on the ZINDI platform : https://zindi.africa/competitions/arm-unicef-disaster-vulnerability-challenge

Context
=======

I join the contest for fun only 5 day before the end and I don't have dedicated very much time to it. So, I just apply pretty famous object detection models on the dataset in order to give a try.

My, idea was first to use pre-trained detection model in order to detect house and their category_id. And secondly, to count "boxes" of each category in each image to produce the results. 

First I tested Yolov7 and Yolov9-e with pretty good results and after that I decided to simply try the best of the moment on MSCOCO dataset according https://paperswithcode.com/sota/object-detection-on-coco-minival. 

It's CO-DETR.

To test it easyly, I choose the mmdetection library implementation : https://github.com/open-mmlab/mmdetection/tree/main/projects/CO-DETR

So, I take the best already trained model and fine-tune it on the dataset.

I just formated all the data to COCO format, and split to 90/10 for train and validation set. 

I updated the base config of co_dino_5scale_r50_lsj_8xb2_1x_coco to 3 classes

And change the size and ratio of the random resize in with co_dino_5scale_swin_l_16xb1_16e_o365tococo : [(640, 640),(960, 960),(500, 500),(1000, 1000),(1024, 1024),]

And lr to 0.0001

After training, I run inference and manually try to choose the best threshold to apply before compiling the results, 0.45 value, seems give better result on the public test, so I keep it and not try to over post-process this value to avoid overfit.

How to reproduce results
========================

Install dependancies
--------------------

* pandas 
* tqdm
* numpy
* Pillow
* pytorch (https://pytorch.org/get-started/locally/)
* mmdetection (install procedure : https://mmdetection.readthedocs.io/en/latest/get_started.html)


I made a conda environment, I use mamba for my managing my  environment (https://mamba.readthedocs.io/en/latest/installation/micromamba-installation.html) is the same as conda but fast

    mamba env create -f environment.yml
    mamba activate zindi

For pytorch following and my CUDA version :

    pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121

For mmdetection

    pip install -U openmim
    mim install mmengine
    mim install "mmcv>=2.0.0"

    cd mmdetection
    pip install -v -e .


Run the code
============

Prepare data

    python 1_prepare_data.py

Train Co-DETR model

    ./2_train.sh

Run Inference on test set

    /3_test.sh

Format prediction and produce final file
    
    python 4_format_result.py

final result should at data/final_pred_test_codetr_2_960_ct045.csv